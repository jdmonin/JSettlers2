/**
 * Java Settlers - An online multiplayer version of the game Settlers of Catan
 * This file Copyright (C) 2017-2018 Jeremy D Monin <jeremy@nand.net>
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation; either version 3
 * of the License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 * The maintainer of this program can be reached at jsettlers@nand.net
 */

syntax = "proto3";

option java_package = "soc.proto";
option optimize_for = SPEED;  // json needs proto metadata, can't use smaller/cleaner LITE_RUNTIME

import public "data.proto";


// Messages during play of a specific game, dispatched at server by a GameMessageHandler.
//
// GameMessages are grouped by category. See the bottom of this file
// for GameMessageFromServer and FromClient, which use OneOf union groups.
// Those main GameMessage types are themselves sent as a OneOf field
// of the main Message.FromServer and Message.FromClient types.
//


//
// Board Layout and Contents
//

/* Board layout contents.
 * Sent when game starts or client joins a game in progress.
 * Applies to entire game (player_number field is unused).
 * TODO: Ref to list of part keynames, etc
 */
message BoardLayout
{
    /* Board layout encoding format versions, from {@link soc.game.SOCBoard#getBoardEncodingFormat()} */
    enum _LayoutEncodingFormat {
        /* Required for enum, but not sent */
        _UNSENT_DEFAULT_ENCODING = 0;

        /* Not supported in JSettlers v3.x.xx: "v1" Original format : hexadecimal 0x00 to 0xFF. */
        BOARD_ENCODING_ORIGINAL = 1;

        /* Not supported in JSettlers v3.x.xx: 6-player board, variant of original format:
         * hexadecimal 0x00 to 0xFF.
         * Added in v1.1.08.
         */
        BOARD_ENCODING_6PLAYER = 2;

        /* Large sea board ({@link SOCBoardLarge}); minimum supported board encoding for v3.x.xx.
         * Coordinate range for rows, columns is each 0 to 255 decimal.
         * Arbitrary mix of land and water tiles. Activated with {@link SOCGameOption} "SBL".
         * Added in v2.0.00.
         */
        BOARD_ENCODING_LARGE = 3;
    };

    message _BoardLayoutPart {
        oneof val {
            int32 i_val = 1;    // signed integer value
            string s_val = 2;   // string value
            _IntArray i_arr = 3;  // signed integer array; negative values allowed but not frequently used
            _BoardCoordList coordinate_list = 4;  // general board coordinate list
            _EdgeList edge_list = 5;  // edge coordinate list
            _HexList hex_list = 6;    // hex coordinate list
            _NodeList node_list = 7;  // node coordinate list
        }
    }

    _LayoutEncodingFormat layout_encoding = 1;  // Board layout encoding format version

    map<string, _BoardLayoutPart> parts = 2;  // Layout Parts; some are optional depending on game options and scenario
}

/* A list of potential settlements, with optional related potential/legal position info.
 * Sent from server when game starts or client joins a game in progress.
 * This definitively sends the player's current possible placement locations, instead of having the client
 * try to infer it from the board and rules. Some seafarers scenarios have nonstandard restrictions
 * on where the players can place. By having the server be authoritative on this, more scenarios
 * could be added later without a client change.
 *<P>
 * Player Number field may be -1 if applies to all players at start of game.
 * -1 also indicates that the legal settlements should be set and the
 * legal roads recalculated from this message's list of potential nodes.
 *<P>
 * If the game has already started, Land Area contents are sent when
 * {@code player_number} == 0 and board's legal roads should be
 * calculated at that point.
 */
message PotentialSettlements {
    /* Potential settlement node coordinates for {@link #playerNumber}.
     * - If this field contains only a single (r=0, c=0) coordinate, treat it as empty (not as missing):
     *   This player currently has no potential settlements.
     * - If this field is missing and {@code starting_land_area} is 0, use all land areas'
     *   legal nodes as the player's potential coordinates.
     */
    repeated NodeCoord ps_nodes = 1;

    /* How many Land Areas this board has; classic boards have 1 */
    uint32 area_count = 2;

    /* Which land area number within {@link #landAreasLegalNodes} contains {@link #psNodes}?
     * 0 if none because the game already started and {@code psNodes} is unique to the player.
     * 0 if none when game is starting now and players can place anywhere.
     *<P>
     * Not used if {@link #areaCount} == 1.
     */
    uint32 starting_land_area = 3;

    /* Each land area's legal node coordinates; keys are 1 to {@link areaCount}.
     * Areas 0 and {@link #startingLandArea} are unused. Not sent if {@code areaCount} == 1.
     */
    map<uint32, _NodeList> land_areas_legal_nodes = 4;

    /* legal sea edges per player for ships, if restricted.
     * Usually not sent, because all sea edges are legal except in scenario _SC_PIRI.
     *<P>
     * If {@link #playerNumber} != -1, {@code legalSeaEdges} contains 1 array, the legal sea edges for that player.
     * Otherwise contains 1 array for each player position (total 4 or 6 arrays).
     *<P>
     * Each per-player array is the same format as in {@code SOCBoardAtServer.PIR_ISL_SEA_EDGES}:
     * A list of individual sea edge coordinates and/or ranges.
     * Ranges are designated by a pair of positive,negative numbers:
     * 0xC04, -0xC0D is a range of the valid edges from C04 through C0D inclusive.
     * If a player position is vacant, their subarray may be empty (length 0) or contain a single zero: <tt>{ (r=0, c=0) }</tt>.
     */
    repeated _EdgeList legal_sea_edges = 5;
}

/* This message from server updates the value field(s) of a piece on the board.
 *
 *<H5>Current uses (v2.0.00):</H5>
 *<UL>
 * <LI> Cloth count for a village in the {@code SC_CLVI} cloth trade scenario
 * <LI> Fortress strength in the {@code SC_PIRI} pirate islands scenario
 *</UL>
 */
message PieceValue {
    /* Type of playing piece, like {@code VILLAGE} or {@code FORTRESS}.
     * Client can ignore this field unless the game's scenario uses values on multiple piece types.
     */
    PieceType type = 1;
    BoardCoord coordinates = 2;  // Coordinate of the piece
    sint32 piece_value1 = 3;  // New value for the piece
    sint32 piece_value2 = 4;  // New secondary value (if piece has 2 value fields)
}

/* Client player is asking to buy and build, or server is announcing placement of, a piece on the board.
 * Also used when joining a new game or a game in progress, to send the game state so far.
 *<P>
 * If message is from server for a {@link soc.game.SOCCity} while client is joining a game, must precede
 * by sending that client a {@code BuildPiece} message with the Settlement at the same coordinate
 * which was upgraded to that city.
 *<P>
 * Some game scenarios use {@link soc.game.SOCVillage villages} which aren't owned by any player;
 * their {@code player_number} is -1 in this message.
 *<P>
 * See also {@link MovePiece}. The messages similar but opposite to this one
 * are {@link CancelBuild} and the very-limited {@link RemovePiece}.
 *<P>
 * Some scenarios like {@link soc.game.SOCScenario#K_SC_PIRI SC_PIRI} include some pieces
 * as part of the initial board layout while the game is starting. These will all be sent to
 * the clients while game state is &lt; {@link soc.game.SOCGame#START1A START1A} and before
 * sending them {@link StartGame}. Scenario {@link soc.game.SOCScenario#K_SC_CLVI SC_CLVI}
 * sends its neutral villages before {@code START1A} but as part {@code "CV"} of the board layout
 * message, not as {@code BuildPiece}s.
 *<P>
 * If this is a placement request from a client player: If successful, server announces
 * {@link SOCPlayerElement} messages to the game for the resources spent, {@code BuildPiece},
 * and the new {@link State}. Otherwise server responds with an explanatory {@link GameServerText} and,
 * if the gamestate allowed placement but resources or requested coordinates
 * disallowed it, the current {@link State} and then a {@link CancelBuild}.
 * After rejection the gamestate may be a placement state such as {@code PLACING_ROAD}.
 *<P>
 * Before v3.0.00 this message was {@code SOCPutPiece}.
 *
 * @see CancelBuild
 * @see BuyInventoryItemRequest
 */
message BuildPiece {
    PieceType type = 1;

    /* The piece's edge, node, or hex coordinate.
     * See data.BoardCoord doc for which types set which field
     * (edge_coord or node_coord).
     */
    BoardCoord coordinates = 2;
}

/* This message from client means that the client player wants to buy a development card.
 * Some future scenario or expansion might also use it to request buying other inventory items.
 *<P>
 * During game state {@code PLAY1}, this is a normal buy request.
 * When sent during other game states, and other players' turns, this is a request
 * to start the 6-player Special Building Phase.
 *<P>
 * If the player can buy a card, the server replies to the client with
 * {@link SOCDevCardAction DEVCARDACTION}({@link SOCDevCardAction#DRAW}, {@link SOCDevCardConstants typeconstant}),
 * and to all other players with {@link SOCDevCardAction DEVCARDACTION}({@link SOCDevCardAction#DRAW},
 * {@link SOCDevCardConstants#UNKNOWN}).
 *<P>
 * If there are no cards remaining to buy, or player doesn't have enough resources,
 * isn't currently their turn, or the player otherwise can't buy a card right now,
 * the server will send them a text response denying the buy. Instead of that text,
 * robot clients will be sent a {@link CancelBuildRequest} message.
 *<P>
 * Before v3.0.00 this message was {@code SOCBuyDevCardRequest} and
 * {@code SOCInventoryItemAction(action = BUY)}.
 *
 * @see CancelBuild
 */
message BuyInventoryItemRequest {
    /* True if not requesting a Dev Card, but instead want to buy a generic inventory item */
    bool is_not_dev_card = 1;

    /* The type of generic inventory item, from {@link SOCInventoryItem#itype},
     * if player has any choice of which type to buy. For Dev Card, omit this field.
     */
    sint32 other_inv_item_type = 2;
}

/* Client player request, or server response or announcement, about
 * Development Cards or other {@link SOCInventoryItem}s in a player's inventory.
 *<P>
 * Detailed message documentation location is TBD; for now see javadoc
 * of {@code soc.message.SOCDevCardAction} and {@code SOCInventoryItemAction}.
 *<P>
 * Player Number field is -1 for action type {@code CANNOT_PLAY}; see that enum value for details.
 *<P>
 * Before v3.0.00 this message was {@code SOCDevCardAction} and {@code SOCInventoryItemAction}.
 */
message InventoryItemAction {
    /* Types of action to take. Each action is sent only from server,
     * not as a request from a client, except where noted.
     */
    enum _ActionType {
        /* Required for enum, but not sent */
        _UNSENT_DEFAULT_ACTION = 0;

        /* Draw/Buy: From Server, action to add a Dev Card as new
         * to player's inventory (like ADD_NEW) from the deck.
         * Acts as a hint in case the client animates Dev Card draws from the deck.
         * Otherwise equivalent to ADD_NEW.
         * Is reply to client's {@link BuyInventoryItemRequest} message.
         */
        DRAW = 1;

        /* remove as old from player's inventory (action from server or request from client).
         *<P>
         * If this is from server for a non-Dev Card item:
         * Check the {@link #isKept} flag to see if the item should be removed from inventory, or remain with state KEPT.
         * Call {@link SOCInventoryItem#isPlayForPlacement(SOCGame, int)}: If true, playing this item requires placement;
         * client receiving the message should call {@link SOCGame#setPlacingItem(SOCInventoryItem)}.
         */
        PLAY = 2;

        /* Draw/Buy: Add as new to player's inventory; not playable this turn.
         * Same as DRAW but without implying the item has just came from the Dev Card deck;
         * can be used when client player sits down to take over a robot, and is sent its
         * inventory details.
         */
        ADD_NEW = 3;

        /* Add as old to player's inventory; can be played/activated this turn if is_playable flag is set */
        ADD_OLD = 4;

        /* The bot can't play the requested card at this time.
         * This is sent only to the requesting robot, so playerNumber is always -1 in this message.
         */
        CANNOT_PLAY = 5;

        /* If some other game action or event causes an item to need placement on the board,
         * but it was never in the player's inventory, server sends {@code PLACING_EXTRA}
         * to give the item details such as {@link #itemType} and {@link #canCancelPlay}.
         * May be sent to entire game or just to the placing current player.
         *<P>
         * Play/placement rules are specific to each kind of inventory action, and the
         * {@code PLACING_EXTRA} message may be sent before a game state change or other
         * messages necessary for placement. The client handling {@code PLACING_EXTRA}
         * should call {@link SOCGame#setPlacingItem(SOCInventoryItem)} and wait
         * for those other messages. When they arrive, client can call
         * {@link SOCGame#getPlacingItem()} to retrieve the item details.
         */
         PLACING_EXTRA = 6;
    };

    _ActionType action_type = 1;

    /* Specific type of Dev Card or Inventory Item */
    oneof item_value {
        /* Type of dev card, like {@link DevCardValue#ROADS}.
         * See ProtoMessageBuildHelper.fromDevCardValue / .toDevCardValue methods
         */
        DevCardValue dev_card_value = 2;

        /* Type of generic inventory item, from {@link SOCInventoryItem#itype} */
        int32 other_inv_item_type = 3;
    }

    // detail/flag fields for non-DevCard inventory items:

    /* Optional reason codes for the CANNOT_PLAY action, corresponding
     * to {@link SOCGame#canPlayInventoryItem(int, int)} return codes, or 0.
     */
    sint32 reason_code = 21;

    /* If true, this item being added can be played or activated.
     * Never sent for action_types PLAY or CANNOT_PLAY.
     */
    bool is_playable = 22;

    /* If true, this item being added is kept in inventory until end of game.
     * Never sent for action_types PLAY or CANNOT_PLAY.
     */
    bool is_kept = 23;

    /* If true, this item being added is worth victory points.
     * Never sent for action_types PLAY or CANNOT_PLAY.
     */
    bool is_VP = 24;

    /* If true, this item is being added and its later play or placement can be canceled:
     * See {@link SOCInventoryItem#canCancelPlay}.
     * Never sent for action_types PLAY or CANNOT_PLAY.
     */
    bool can_cancel_play = 25;

}

/* This message type has five possible meanings, depending on game state and direction sent:
 *<UL>
 *<H3>When sent from client to server:</H3>
 *<LI> During piece placement (PLACING_ROAD, PLACING_SETTLEMENT, PLACING_CITY, PLACING_SHIP, PLACING_INV_ITEM): <BR>
 *   CancelBuild means the player has changed their mind about spending resources to build a piece.
 *   Server will reply by returning the player's resources and changing game state.
 *   <P>
 *   The special inventory items in PLACING_INV_ITEM each have a different placement message, but if item placement
 *   can be canceled, use this common message type, with {@code item_type} == ({@link Data.OtherPlayableItem#INV_ITEM}).
 *   If placement can't be canceled, server will reply with {@link GameServerText}.
 *
 *<LI> While placing the second free road or ship (PLACING_FREE_ROAD2), means
 *   the player has decided to skip placing the second free road or ship,
 *   to use just one road or ship piece.  Server will reply with new game state.
 *   (This was added in v1.1.17)
 *
 *<LI> Not sent from client during other game states. Server will reply with {@link GameServerText}.
 *
 *<H3>When sent from server to a client player:</H3>
 *
 *<LI> During game startup (START1B, START2B or START3B): <BR>
 *   Sent from server, CancelBuild means the current player
 *   is undoing the placement of their initial settlement.
 *
 *<LI> During piece placement (PLACING_ROAD, PLACING_CITY, PLACING_SETTLEMENT,
 *   PLACING_FREE_ROAD1 or PLACING_FREE_ROAD2): <BR>
 *   Sent from server, CancelBuild means the player has sent
 *   an illegal {@link PutPiece} (bad building location). Humans can probably
 *   decide a better place to put their road, but robots must cancel
 *   the build request and decide on a new plan.
 *   <P>
 *   This can also be the reply if the client sends an illegal {@link PutPiece}
 *   or {@link BuyInventoryItemRequest} (no resources, not the right game state, etc.)
 *   or {@link MovePiece}.
 *
 *<LI> player_number field is unused.
 *</UL>
 * Before v3.0.00 this message was {@code SOCCancelBuildRequest}.
 */
message CancelBuild {
    oneof cancel_type {
        PieceType piece_type = 1;
        OtherPlayableItem item_type = 2;
    }
}

/* Client player is asking to move, or server is announcing a move of,
 * a piece on the board to a new location.
 *<H3>From Server:</H3>
 * The client should also print a line of text such as "* Joe moved a ship."
 *<H3>From Client:</H3>
 * The server will reply to all players with {@link MovePiece} if piece can be moved,
 * or reply to the requesting client with {@link CancelBuildRequest}.
 *<P>
 * Before v3.0.00 this message was {@code SOCMovePieceRequest} and {@code SOCMovePiece}.
 */
message MovePiece {
    /* Type of playing piece; only {@code SHIP} so far */
    PieceType type = 1;
    BoardCoord from_coordinates = 2;
    BoardCoord to_coordinates = 3;
}

/* This message from server announces a {@link soc.game.SOCShip} removed from the board.
 * Ships are removed when the player makes an attack on their Pirate Fortress and fails to win.
 * Currently, no other piece types are removed in any scenario, but the message allows for other types
 * in case that changes in a later version.
 *<P>
 * Introduced in v2.0.00 for the pirate islands scenario (_SC_PIRI).
 */
message RemovePiece {
    /* Type of playing piece; only {@code SHIP} so far */
    PieceType type = 1;
    BoardCoord coordinates = 2;
}


//
// Game and Player State
//

/* The current state of the game, sent when it changes.
 * Applies to entire game (player_number field is unused).
 *<P>
 * Messages which change the current turn or player, like {@link Turn}
 * and {@link StartGame}, include the new turn's state as a field because
 * the current player and game state are both changing.
 *<P>
 * For some states, such as {@link Data.GameState#WAITING_FOR_ROB_CHOOSE_PLAYER},
 * another message (such as {@link ChoosePlayerRequest}) will
 * follow to prompt the current player.  For others, such as
 * {@link Data.GameState#WAITING_FOR_DISCOVERY} or
 * {@link Data.GameState#WAITING_FOR_ROBBER_OR_PIRATE}, sending this
 * State message implies that the player must decide and respond.
 *<P>
 * For {@link Data.GameState#WAITING_FOR_ROBBER_OR_PIRATE}, the player should
 * respond with {@link ChoosePlayer}; see that message's javadoc.
 *<P>
 * Before v3.0.00 this message was {@code GameState}.
 */
message State {
    GameState state = 1;
}

/* Action types for use in PlayerElement and PlayerElements; not sent as a standalone message type */
enum _PlayerElementAction {
    _UNSENT_DEFAULT_ACTION = 0;  // Required for enum, but not sent: not a valid action type
    SET  = 1;  // Set element to value
    GAIN = 2;  // Add value to element
    LOSE = 3;  // Subtract value from element
}

/* Player element types for use in PlayerElement and PlayerElements; not sent as a standalone message type */
enum _PlayerElementType {
    /* Required for enum, but not sent: not a valid player element */
    _UNSENT_DEFAULT_PLAYER_ELEM = 0;

    /*
     * player element types (1-5). CLAY has same value
     * as {@link Data.ResourceType#CLAY_VALUE};
     * ORE, SHEEP, WHEAT and WOOD also match Data.ResourceType.
     * and {@code SOCResourceConstants}.
     */
    ELEM_CLAY = 1;
    ELEM_ORE = 2;
    ELEM_SHEEP = 3;
    ELEM_WHEAT = 4;
    ELEM_WOOD = 5;

    /*
     * Amount of resources of unknown type; sent in messages about opponents' resources.
     * For some loops which send resource types + unknown, this constant is assumed to be 6
     * (5 known resource types + 1).
     */
    ELEM_UNKNOWN_RESOURCE = 6;

    /* Number of Road pieces available to place. */
    ROADS = 10;

    /* Number of Settlement pieces available to place. */
    SETTLEMENTS = 11;

    /* Number of City pieces available to place. */
    CITIES = 12;

    /*
     * Number of Ship pieces available to place.
     * @since 2.0.00
     */
    SHIPS = 13;

    /*
     * Number of knights in player's army; sent after a Soldier card is played.
     */
    NUMKNIGHTS = 15;

    /*
     * For the 6-player board, player element type for asking to build
     * during the {@link soc.game.SOCGame#SPECIAL_BUILDING Special Building Phase}.
     * This element is {@code SET} to 1 or 0.
     * @since 1.1.08
     */
    ASK_SPECIAL_BUILD = 16;

    /*
     * Total resources this player has available in hand to use.
     * Sent only with {@code SET}, not {@code GAIN} or {@code #LOSE}.
     * @since 2.0.00
     */
    RESOURCE_COUNT = 17;

    /*
     * Node coordinate location of this player's most recently placed settlement, or 0.
     * Used for robots during initial placement at the start of a game.
     * Sent only with {@code SET}, not {@code GAIN} or {@code #LOSE}.
     * @since 2.0.00
     */
    LAST_SETTLEMENT_NODE = 18;

    /*
     * Has this player played a development card already this turn?
     * Applies to all players if {@code playerNumber} == -1.
     * This element is {@code SET} to 1 or 0, never sent with {@code GAIN} or {@code #LOSE}.
     * @since 2.0.00
     */
    PLAYED_DEV_CARD_FLAG = 19;

    //
    // Elements related to scenarios and sea boards:
    //

    /*
     * For the {@link soc.game.SOCBoardLarge large sea board},
     * player element type for asking to choose
     * resources from the gold hex after a dice roll,
     * during the {@link soc.game.SOCGame#WAITING_FOR_PICK_GOLD_RESOURCE WAITING_FOR_PICK_GOLD_RESOURCE}
     * game state.
     * This element is {@code SET} to 0 or to the number of resources to choose.
     * Call {@link soc.game.SOCPlayer#setNeedToPickGoldHexResources(int)}.
     * @since 2.0.00
     */
    NUM_PICK_GOLD_HEX_RESOURCES = 101;

    /*
     * For scenarios on the {@link soc.game.SOCBoardLarge large sea board},
     * the player's number of Special Victory Points (SVP).
     * This element is {@code SET} to 0 or to the player's
     * {@link soc.game.SOCPlayer#getSpecialVP()}.
     * @since 2.0.00
     */
    SCENARIO_SVP = 102;

    /*
     * For scenarios on the {@link soc.game.SOCBoardLarge large sea board},
     * bitmask of flags related to scenario player events.
     * This element is {@code SET} to 0 or to the player's flags
     * from {@link soc.game.SOCPlayer#getScenarioPlayerEvents()}.
     * @since 2.0.00
     */
    SCENARIO_PLAYEREVENTS_BITMASK = 103;

    /*
     * For scenarios on the {@link soc.game.SOCBoardLarge large sea board},
     * bitmask of land areas for tracking Special Victory Points (SVP).
     * This element is {@code SET} to 0 or to the player's land areas
     * from {@link soc.game.SOCPlayer#getScenarioSVPLandAreas()}.
     * @since 2.0.00
     */
    SCENARIO_SVP_LANDAREAS_BITMASK = 104;

    /*
     * Player's starting land area numbers.
     * Sent only at reconnect, because these are also tracked during play at the client.
     * Sent as <tt>(landArea2 &lt;&lt; 8) | landArea1</tt>.
     * @since 2.0.00
     */
    STARTING_LANDAREAS = 105;

    /*
     * For scenario <tt>_SC_CLVI</tt> on the {@link soc.game.SOCBoardLarge large sea board},
     * the number of cloth held by this player.
     * This element is {@code SET} to 0 or to the player's cloth count
     * from {@link soc.game.SOCPlayer#getCloth()}.
     * After giving cloth to a player, check their total VP; 2 cloth = 1 Victory Point.
     *<P>
     * The board's "general supply" is updated with this element type
     * with {@link #getPlayerNumber()} == -1.
     * Each village's cloth count is updated with a {@link SOCPieceValue PIECEVALUE} message.
     * @since 2.0.00
     */
    SCENARIO_CLOTH_COUNT = 106;

    /*
     * For scenario game option <tt>_SC_PIRI</tt>,
     * the player's total number of ships that have been converted to warships.
     * See SOCPlayer.getNumWarships() for details.
     * This element can be {@code SET} or {@code GAIN}ed.  For clarity, if the number of
     * warships decreases, send {@code SET}, never send {@code LOSE}.
     * {@code GAIN} is sent only in response to a player's successful
     * {@link SOCPlayDevCardRequest} to convert a ship to a warship.
     *<P>
     * If a player is joining a game in progress, the <tt>PLAYERELEMENT(SCENARIO_WARSHIP_COUNT)</tt>
     * message is sent to their client only after sending their SOCShip piece positions.
     * @since 2.0.00
     */
    SCENARIO_WARSHIP_COUNT = 107;
}

/*
 * This message from the server conveys one part of a player's status,
 * such as their number of settlements remaining.
 *<P>
 * Unless otherwise mentioned, any {@code elementType} can be sent with
 * any action ({@link _PlayerElementAction#SET}, {@link _PlayerElementAction#GAIN GAIN},
 * {@link _PlayerElementAction#LOSE LOSE}).
 *<P>
 * Player Number: Some element types can use -1 for all players, some others don't use that field.
 * See _PlayerElementType for details.
 *
 *<H3>Message Sequence:</H3>
 *<UL>
 * <LI> For a bank trade (server response to player's {@link BankTrade}),
 *   all the {@code LOSE} messages come before the {@code GAIN}s.
 * <LI> For trade between players ({@link AcceptOffer}), the {@code LOSE}s and {@code GAIN}s
 *   are interspersed to simplify server code.
 * <LI> Most other situations send single PlayerElement messages or their sequence doesn't matter.
 *</UL>
 *<P>
 * Resource loss can be expected and good (buying pieces or trading with other players)
 * or unexpected and bad (monopoly, robber, discards). v1.2.00 and newer have sound effects
 * to announce unexpected gains or losses; to help recognize this, this message type has a
 * {@link #isNews()} flag field.
 *<P>
 * To use less overhead to send multiple similar element changes, use {@link PlayerElements} instead.
 */
message PlayerElement {
    _PlayerElementAction action = 1;
    _PlayerElementType element_type = 2;
    sint32 amount = 3;
    bool is_news = 4;
}

/*
 * This message from the server holds information on some parts of a player's status,
 * such as resource type counts.  Same structure as {@link PlayerElement} but with
 * less overhead to send multiple similar element changes.
 *<P>
 * Player Number: Some element types can use -1 for all players, some others don't use that field.
 * See _PlayerElementType for details.
 *<P>
 * For a given player number and action type, contains parallel lists for sending
 * (element type, amount) pairs.
 *<P>
 * Defined in v1.1.09 but unused before v2.0.00.
 */
message PlayerElements {
    _PlayerElementAction action = 1;
    repeated _PlayerElementType element_types = 2;
    repeated sint32 amounts = 3;
}

/* This message from the server sets or updates fields of a game's status,
 * such as the number of rounds played or development cards available.
 *<P>
 * Applies to entire game (player_number field is unused).
 * @since 2.0.00
 */
message GameElements {

    enum _ElementType {
        /* Required for enum, but not sent: not a valid game element */
        _UNSENT_DEFAULT_GAME_ELEM = 0;

        /* Current round of play, from {@link soc.game.SOCGame#getRoundCount()}. */
        ROUND_COUNT = 1;

        /* Number of development cards remaining in the deck to be bought,
         * from {@link soc.game.SOCGame#getNumDevCards()}.
         */
        DEV_CARD_COUNT = 2;

        /* Player number of first player in this game, from {@link soc.game.SOCGame#getFirstPlayer()}. */
        FIRST_PLAYER = 3;

        /* Player number of current player, or -1, from {@link soc.game.SOCGame#getCurrentPlayerNumber()}. */
        CURRENT_PLAYER = 4;

        /* Player number of player with largest army, or -1, from {@link soc.game.SOCGame#getPlayerWithLargestArmy()}. */
        LARGEST_ARMY_PLAYER = 5;

        /* Player number of player with longest road, or -1, from {@link soc.game.SOCGame#getPlayerWithLongestRoad()}. */
        LONGEST_ROAD_PLAYER = 6;
    }

    repeated _ElementType element_types = 1;
    repeated sint32 values = 2;
}


//
// Current Turn
//

/* From client, this message means that a player wants to start the game;
 * from server, it means that a game has just started, leaving state {@code NEW}.
 * Applies to entire game (player_number field is unused).
 *<P>
 * If a client joins a game in progress it won't be sent a {@code SOCStartGame} message,
 * only the game's current {@code GameState} and other parts of the game's and
 * players' current status.
 */
message StartGame {
    GameState state = 1;  // new state; ignored from client
}

/* End of the current player's turn, start of a new turn.
 * Client should end current turn, clear dice, set current player number, reset votes, etc.
 * New player's client should check the state field to inform that player's options and actions.
 *<P>
 * Applies to entire game: player_number is the new current player's seat number.
 *<P>
 * Also sent at game state {@link Data.GameState#OVER} to confirm the winning player,
 * who will already be the current player.
 *<P>
 * Also can be sent to a client joining a game in progress, to set only the current player number.
 * In this case {@code state} will be empty or 0. Before v3.0.00 this usage was a separate
 * {@code SOCSetTurn} message type.
 */
message Turn {
    GameState state = 1;  // new state, or empty/0 when joining game in progress
}

/* This message from server to client says whose turn it is.
 * Only the game's current player number should change; no other
 * game state is updated.
 *<P>
 * Applies to entire game: player_number is the new current player's seat number.
 */
message SetTurn {
    // No detail fields are needed beyond GameMessageFromServer.player_number
}

/* Prompt from server to entire game telling the current player to roll dice,
 * or request from that client player to roll.
 *<P>
 * From server, includes player number being prompted to roll.
 * Currently this is always the current player; in some future expansion
 * it could be a different player.
 *<P>
 * Before v3.0.00 this message was {@code SOCRollDicePrompt} and {@code SOCRollDice}.
 */
message DiceRollRequest {
    // No detail fields are needed beyond GameMessageFromServer.player_number
}

/* Reports the total of what was rolled on the dice this turn.
 * The two individual dice amounts can be reported in a text message.
 * Applies to entire game (player_number field is unused).
 *<P>
 * This is in response to a client player's {@link DiceRollRequest}.
 * Will always be followed by {@link State} (rolling a 7 might lead to discards
 * or moving the robber, etc.) and sometimes with further messages after that,
 * depending on the roll results and scenario/rules in effect.
 *<P>
 * When players gain resources on the roll, game members will be sent {@link DiceResultResources}.
 *<P>
 * Players who gain resources on the roll will be sent
 * {@link PlayerElement PlayerElement(SET, resType, amount)} messages
 * for all their new resource counts.  Before v2.0.00 those were sent to each
 * player in the game after a roll, not just those who gained resources, followed by
 * sending the game a PlayerElement with their new total {@code RESOURCE_COUNT}.
 */
message DiceResult {
    /* Total rolled on both dice, 0 at start of turn,
     * or -1 at start of game; see SOCGame.getCurrentDice()
     */
    sint32 dice_total = 1;
}

/* All resources gained by players from a dice roll, and their new resource totals.
 * Announced to all game members after a {@link DiceResult} where players gain resources.
 * Applies to entire game (player_number field is unused).
 */
message DiceResultResources {
    /* One player's gained resource types, amounts, and totals. */
    message PlayerResources {
        uint32 player_number = 1;    // Player number gaining resources
        ResourceSet res_gained = 2;  // Type and amount of resources gained
        uint32 res_total = 3;        // Player's new total resource count
    }

    repeated PlayerResources player_resources = 1;
}

/* Player wants to end their turn; a request sent from client, not an announcement from server. */
message EndTurn {
    // no detail fields are needed
}


//
// Player Info
//


//
// Player Actions
//

// TODO simple request
// TODO simple action


//
// Player Actions: Trade
//

/* Client is making, or server is announcing, a bank trade or port trade.
 * Also used to undo player's previous trade (swap previous give/get resource sets).
 *<P>
 * Before v3.0.00 this message was SOCBankTrade.
 * @see TradeMakeOffer
 */
message TradeWithBank {
    ResourceSet give = 1;
    ResourceSet get  = 2;
}

/* Client is making, or server is announcing, a trade offer.
 * Other player clients may respond with TradeRejectOffer or TradeAcceptOffer.
 *<P>
 * player_number is the player offering this trade to some or all other players.
 *<P>
 * Before v3.0.00 this message was SOCMakeOffer.
 * @see TradeWithBank
 * @see TradeClearOffer
 */
message TradeMakeOffer {
    ResourceSet give = 1;
    ResourceSet get  = 2;
    _IntArray to_players = 3;  // only needed if offer is not to all other player numbers (not only seated ones)
    int32 offer_serial = 4;  // optional offer number assigned by server, or 0 if server has not done so; ignored from client
}

/* A the player is retracting an offer.
 * Or, all players are clearing all offers (usually at end of turn).
 *<P>
 * player_number can be -1 to clear all offers by all players.
 * @see TradeMakeOffer
 */
message TradeClearOffer {
    // No detail fields are needed beyond GameMessageFromServer.player_number
}

/* A player is rejecting any and all trade offers currently made to them.
 * @see TradeMakeOffer
 * @see TradeAcceptOffer
 */
message TradeRejectOffer {
    // No detail fields are needed beyond GameMessageFromServer.player_number
}

/* A player is accepting a trade offer currently made to them.
 * If sent from client and trade is allowed, server responds with
 * {@link PlayerElement}s, {@link GameServerText}, {@link TradeClearOffer}s,
 * then (for robots' benefit) the received TradeAcceptOffer is re-sent to
 * all clients in the game.
 *<P>
 * From server, player_number is the player accepting this trade from offering_player_number.
 * @see TradeMakeOffer
 * @see TradeRejectOffer
 */
message TradeAcceptOffer {
    int32 offering_player_number = 1;  // player number offering the trade being accepted

    int32 offer_serial = 2;  // offer number from TradeMakeOffer, if not 0, in case of unexpected last-minute new offers
}


//
// GameMessageFromServer, GameMessageFromClient: For encode/decode, a GameMessage type
// containing all other message types using OneOf. These main GameMessageFromServer
// and FromClient types are sent as a OneOf in the main Message.FromServer and FromClient.
//


message GameMessageFromServer {
    string game_name = 1;

    /* Player Number this applies to, if any. Some messages apply to the entire game
     * and don't use a player number; others may use -1 to indicate all players.
     * Those situations are documented at the message.
     */
    sint32 player_number = 2;

    oneof msg {

        // game and player state
        State game_state = 3;
        PlayerElement player_element = 15;
        PlayerElements player_elements = 16;  // above #15; is efficient enough (sets multiple elements) without that saved byte
        GameElements game_elements = 17;

        // board layout and contents
        BoardLayout board_layout = 30;
        PotentialSettlements potential_settlements = 31;
        PieceValue piece_value = 32;
        BuildPiece build_piece = 33;
        CancelBuild cancel_build = 34;
        MovePiece move_piece = 35;
        RemovePiece remove_piece = 36;

        // turn
        StartGame start_game = 100;
        Turn turn = 101;
        SetTurn set_turn = 102;
        DiceRollRequest dice_roll_request = 103;
        DiceResult dice_result = 104;
        DiceResultResources dice_result_resources = 105;

        // player info

        // player actions
        // (simplerequest = 300)
        // (simpleaction = 301)
        InventoryItemAction inventory_item_action = 302;

        // player actions: trade
        TradeWithBank trade_with_bank = 400;
        TradeMakeOffer trade_make_offer = 401;
        TradeClearOffer trade_clear_offer = 402;
        TradeRejectOffer trade_reject_offer = 403;
        TradeAcceptOffer trade_accept_offer = 404;
    }
}

message GameMessageFromClient {
    string game_name = 1;

    oneof msg {
        // turn
        StartGame start_game = 100;
        DiceRollRequest dice_roll_request = 101;
        EndTurn end_turn = 102;

        // player actions: buy/build/play pieces and items
        BuildPiece build_piece = 200;
        CancelBuild cancel_build = 201;
        MovePiece move_piece = 202;
        BuyInventoryItemRequest buy_inventory_item = 203;
        InventoryItemAction inventory_item_action = 204;

        // player actions
        // (simplerequest = 300)
        // (simpleaction = 301)

        // player actions: trade
        TradeWithBank trade_with_bank = 400;
        TradeMakeOffer trade_make_offer = 401;
        TradeClearOffer trade_clear_offer = 402;
        TradeRejectOffer trade_reject_offer = 403;
        TradeAcceptOffer trade_accept_offer = 404;
    }
}
